{namespace rkwOrder=RKW\RkwOrder\ViewHelpers}
{namespace rkwRegistration=RKW\RkwRegistration\ViewHelpers}
<!-- ==================================================================== -->

<f:section name="productList">

	<ul class="order-list">

		<f:for each="{products}" as="product" iteration="productIterator">

			<li class="order-list__item">

				<figure class="order-list__image">
					<f:if condition="{product.image}" >
						<f:then>
							<f:cObject typoscriptObjectPath="plugin.tx_rkworder.libs.responsivePdfThumbnail" data="{product.image.uid}"/>
						</f:then>
						<f:else>
							<f:cObject typoscriptObjectPath="plugin.tx_rkworder.libs.responsivePdfThumbnail" data="EXT:rkw_order/Resources/Public/Images/publications-fallback.jpg"/>
						</f:else>
					</f:if>
				</figure>

				<div class="order-list__details">
					<h4 class="order-list__title">{product.title}</h4>
					<f:if condition="{product.subtitle}">
						<p class="order-list__subtitle">{product.subtitle}</p>
					</f:if>


					<!-- Check for bundle -->
					<f:if condition="{product.productBundle.uid} > 0">
						<f:then>

							<!-- is single order allowed? -->
							<f:if condition="{product.productBundle.allowSingleOrder}">
								<f:render partial="Order/FormFields/Order/Input" arguments="{product: product}" />
							</f:if>


							<div class="order-list__item order-list__item--sub">
								<p class="order-list__belongs">Geh√∂rt zu dieser Reihe/Mappe:</p>
								<div class="order-list__details order-list__details--sub">
									<h4 class="order-list__title">{product.productBundle.title}</h4>


									<!-- check which kind of bundle we have here -->
									<f:if condition="{product.productBundle.recordType} == '\RKW\RkwOrder\Domain\Model\ProductSubscription'">
										<f:then>
											<f:render partial="Order/FormFields/Order/Checkbox" arguments="{product: product.productBundle}" />
										</f:then>
										<f:else>
											<f:render partial="Order/FormFields/Order/Input" arguments="{product: product.productBundle}" />
										</f:else>
									</f:if>
								</div>
							</div>
						</f:then>

						<!-- without bundle -->
						<f:else>
							<f:render partial="Order/FormFields/Order/Input" arguments="{product: product}" />
						</f:else>
					</f:if>
				</div>
			</li>
		</f:for>
	</ul>

</f:section>


<!-- ==================================================================== -->
<f:section name="termsSubmit">

	<!-- remark -->
	<f:comment>
		<div class="v320-1">
			<label for="tx-rkworder-remark" class="form-label">
				<f:translate key="LLL:EXT:rkw_order/Resources/Private/Language/locallang.xlf:tx_rkworder_domain_model_order.remark" />
			</label>
			<f:form.textarea id="tx-rkworder-remark" property="remark" />
		</div>
	</f:comment>

	<p class="v320-1">

		<f:security.ifAuthenticated>
			<f:else>
			<span class="checkbox">
				<label>
					<f:form.checkbox name="terms" value="1" />
					<span class="text-smaller">
						<f:link.page pageUid="{termsPid}" target="_blank">
							<f:translate key="LLL:EXT:rkw_order/Resources/Private/Language/locallang.xlf:partials.order.formFields.order.terms" />
						</f:link.page>
					</span>
				</label>
			</span>
			</f:else>
		</f:security.ifAuthenticated>
		<span class="checkbox">
			<label>
				<f:form.checkbox name="privacy" value="1" />
				<rkwRegistration:privacyText textVersion="order" />
			</label>
		</span>
	</p>
	<p class="v320-1">
		<button class="button" type="submit">
			<span><f:translate key="LLL:EXT:rkw_order/Resources/Private/Language/locallang.xlf:partials.order.formFields.order.orderButton" /></span>
		</button>
	</p>
</f:section>
